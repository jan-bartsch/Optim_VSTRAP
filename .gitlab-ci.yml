stages:
  - build
  - unit_test
  - coverage
  

cache:
  paths:
  - build-OPTIM/
  - test-results/coverage/html 
compile:
  stage: build
  script:
    - rm -rf build-OPTIM
    - mkdir build-OPTIM 
    - cd build-OPTIM 
    - cmake3 -DCMAKE_BUILD_TYPE=DEBUG ..
    - make -j12

run_unit_tests:
  stage: unit_test
  script:
    - cd build-OPTIM/test
    - ./run_tests
    - mkdir test-results


coverage:
  stage: coverage
  script:
    - lcov --capture --directory . --output-file ./test-results/coverage.info
            lcov -r "./test-results/coverage.info" "boost" "*/boost/*" "*/test/*" "armadillo_bits" "*/gtest/*" "*/c++/*" "*/Core/*" "/usr/" "*/gcc/*" -o "./test-results/coverage-filtered.info"
            genhtml ./test-results/coverage-filtered.info     
  artifacts:
    paths:
    - test-results/coverage/html 


    
 
  

